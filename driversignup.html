<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Driver Registration</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="BatmanStyles.css">
<!--   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
     <link rel="stylesheet" href="C:\Users\Nadun Perera\public\test\6\dashL3.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
-->
<style>

.form {
  row-gap: 2px;
}
.input-field {
  border-radius: 8px; 
  padding: 8px;
  width: 100%;
  border: none;
  /*background: rgba(255, 255, 255, 0.2);*/
  background: #e7edfd;
  color: #000;
  margin-bottom: 12px;
  font-size: 1rem;
}

.input-wrapper {
  position: relative;
}

.corner-verify-btn {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  background: var(--primary);
  color: white;
  padding: 6px 8px;
  border-radius: 50%;
  font-size: 0.8rem;
  cursor: pointer;
  transition: background 0.3s;
}

.corner-verify-btn:hover {
  background: var(--primary-hover);
}

input[type="file"] {
  background: none;
  border: none;
  padding: 8px 0;
  font-size: 0.9rem;
  color: var(--text-secondary);
}

.error-text {
  color: #d0444c;
  font-size: 0.85rem;
  margin-top: 4px;
}

.otp-box {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
  animation: fadeIn 0.3s ease-in-out;
}

.confirm-btn {
  padding: 10px 14px;
  background: #2ecc71;
  border: none;
  color: white;
  font-weight: 600;
  border-radius: 12px;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
}

.confirm-btn:hover {
  background: #27ae60;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}

</style>



</head>
<body>
  <div class="card">
    <div class="card2">
      <form id="driverForm" class="form">
    <h2 id="heading">Driver Registration</h2>

    
<input class="input-field" type="text" id="username" placeholder="Username" required>
<input class="input-field" type="password" id="password" placeholder="Password (min 6 chars)" required>
<input class="input-field" type="text" id="fullname" placeholder="Full Name" required>

<div class="verify-wrapper">
  <input class="input-field" type="email" id="email" placeholder="Email" required>
  <button type="button" class="verify-btn" onclick="sendEmailVerification()" title="Verify Email">
    <i class="fas fa-check-circle"></i> Verify Email
  </button>
</div>

<div class="verify-wrapper">
  <input class="input-field" type="text" id="phone" placeholder="Phone Number">
  <button type="button" class="verify-btn" onclick="verifyPhone()" title="Verify Phone" id="verifyPhoneBtn">
    <i class="fas fa-phone"></i> Verify Phone
  </button>
</div>
<!-- Hidden verification section -->
<div id="phoneVerifyBox" class="otp-box" style="display: none;">
  <input class="input-field" type="text" id="phoneOtp" placeholder="Enter OTP code">
  <button type="button" class="confirm-btn" id="confirmOtpBtn">
    <i class="fas fa-check"></i> Confirm
  </button>
</div>


        <label for="profilePic" style="font-size: 0.9rem; text-align: left;">Profile Picture (PNG only, Max 2MB):</label>
        <input type="file" id="profilePic" accept=".png">
        <img id="preview" style="display:none; max-width:100px; border-radius: 8px;">
        <p id="fileError" class="error-text"></p>

<input type="hidden" id="status" value="active">

<button type="submit" class="button1">Register</button>


<div class="bottom-text">
  Already have an account?
  <a href="driverLogin.html">Sign In</a>
</div>
<p id="addMsg" style="color:green;"></p>
<p id="errorMsg" class="error-text"></p>
</form>
  </div>
  </div>

  <!-- ðŸ”½ Firebase Scripts -->

<!-- Firebase v9 SDK -->
<script type="module">
 // âœ… Final Script: Firebase Signup with Email Verification
// âš ï¸ Requires Firebase Auth to be enabled for Email/Password & Phone

import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
import {
  getAuth,
  createUserWithEmailAndPassword,
  sendEmailVerification,
  signInWithPhoneNumber,
  RecaptchaVerifier
} from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";
import {
  getDatabase,
  ref,
  set,
  get,
  child
} from "https://www.gstatic.com/firebasejs/9.14.0/firebase-database.js";

// âœ… Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAalfVG-12m72vwjYnr7IjAc0IwMCGlhY4",
  authDomain: "busdriverlogin.firebaseapp.com",
  databaseURL: "https://busdriverlogin-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "busdriverlogin",
  storageBucket: "busdriverlogin.appspot.com",
  messagingSenderId: "1014266280344",
  appId: "1:1014266280344:web:80bfc786ceadac46d493ed"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth();

// ðŸ“© Trigger Email Verification
document.querySelector('.corner-verify-btn[title="Verify Email"]').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  if (!email || password.length < 6) return alert("Provide valid email & password");

  try {
    const cred = await createUserWithEmailAndPassword(auth, email, password);
    await sendEmailVerification(cred.user);
    alert("Verification email sent. Please check your inbox.");
  } catch (err) {
    alert("âŒ " + err.message);
  }
});

// ðŸ“± Phone OTP Setup
window.recaptchaVerifier = new RecaptchaVerifier('phone', {
  'size': 'invisible',
  'callback': (response) => {
    console.log("reCAPTCHA solved")
  }
}, auth);

async function verifyPhone() {
  const phone = document.getElementById('phone').value.trim();
  if (!phone) return alert("Enter phone number");

  try {
    const confirmationResult = await signInWithPhoneNumber(auth, phone, window.recaptchaVerifier);
    const otp = prompt("Enter OTP sent to your phone:");
    await confirmationResult.confirm(otp);
    alert("âœ… Phone verified successfully");
  } catch (err) {
    alert("âŒ " + err.message);
  }
}

window.verifyPhone = verifyPhone;

// ðŸ“ Form Submission
document.getElementById('driverForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const fullname = document.getElementById('fullname').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const status = document.getElementById('status').value.trim();
  const picture = document.getElementById('profilePic').files[0];

  if (!username || !password || !fullname || !email) return alert("Fill all required fields");
  if (password.length < 6) return alert("Password too short");

  try {
    const userRef = ref(db, 'users/' + username);
    const snapshot = await get(userRef);
    if (snapshot.exists()) return alert("Username already exists");

    const userId = `user_${Date.now()}`;
    const reader = new FileReader();
    reader.onload = async function () {
      await set(userRef, {
        userId,
        user_name: username,
        password,
        full_name: fullname,
        email,
        phone_number: phone,
        profile_picture: picture ? reader.result : null,
        role: 'driver',
        status,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      });
      alert("âœ… Driver registered in database");
    };
    if (picture) reader.readAsDataURL(picture);
    else reader.onload();

  } catch (err) {
    alert("âŒ " + err.message);
  }
});


</script>
 
<script src="/test/6/dash.js"></script>
<script>
  // When DOM is ready
  document.addEventListener("DOMContentLoaded", function () {
    const verifyPhoneBtn = document.getElementById("verifyPhoneBtn");
    const phoneVerifyBox = document.getElementById("phoneVerifyBox");

    verifyPhoneBtn.addEventListener("click", function () {
      phoneVerifyBox.style.display = "flex"; // Show the box
    });

    document.getElementById("confirmOtpBtn").addEventListener("click", function () {
      const otp = document.getElementById("phoneOtp").value.trim();
      if (otp === "") {
        alert("Please enter the OTP code.");
      } else {
        alert("Phone verified successfully!");
        phoneVerifyBox.style.display = "none";
      }
    });
  });
</script>

</body>

</html>
